# Authentication

All API call related to authentication.

Feedbook API uses a token system.

Once you have retrieved your token (with the route GET /v1/login), you must include it in all requests headers.
(except for /v1/login and /v1/register routes) like this:

`Authorization: xxxxxxxxxxx`

<aside class="notice">
You must replace <code>xxxxxxxxxxx</code> with your API token.
</aside>

## Login

This endpoint login a user.

<aside class="notice">
Login returns the token that is required for most of the other endpoints.
</aside>

### HTTP Request

`POST /v1/login`

```json
{
	"status": 200,
	"success": true,
	"msg": "User successfully login.",
	"token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJtYWlsIjoiZmVlZGJvb2tAZ21h",
	"refresh_token": "2qL9d4hY4qaggb9h"
}
```

### BODY PARAMETERS

Parameter | Description
--------- | -----------
email | User's email.
password | User's password.


## Register

This endpoint registers a new user. It sends a mail to the user when it's done.

### HTTP Request

```json
{
  "status": 200,
  "user": {
    "id": 17,
    "email": "lucas@gmail.com",
    "password": "$2b$10$yb6sgtYxLAaq5zTq0KA9vO2EINOLYFjxuBl1mZDBY0qOvrzMr.JHq",
    "username": "LauLau",
    "is_active": 1,
    "is_staff": 1,
    "is_superuser": 1,
    "date_joined": "2018-12-01T21:02:47.034Z",
    "first_name": "Lucas",
    "last_name": "ABCD",
    "profile_picture": "basic_user_pic.jpg",
    "refresh_token": "2qL9d4hY4qaggb9h"
  },
  "profile": {
    "id": 6,
    "public_username": "LauLau",
    "bio": "bonjour je suis gentil",
    "user_id": 17,
    "gender": "m"
  },
  "success": true,
  "msg": "User created successfully."
}
```

`POST /v1/register`

### BODY PARAMETERS

Parameter | Description
--------- | -----------
email | User's email.
password | User's password.
username | User's username.
first_name | User's firstname.
last_name | User's lastname.
bio | User's bio (optional).
gender | "m" for male, "f" for female (optional, set to "n" for "neutral" by default).
is_staff | If the user is a staff member (optional, set to 0 by default).
is_superuser | If the user is a superuser (optional, set to 0 by default).

## Refresh Token

This endpoint refreshs the token of the user.

```json
{
  "status": 200,
  "success": true,
  "msg": "User successfully login.",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IkxlbEB0ZXN0LmFwaVNUUE1BUkNIRSIsImlhdCI6MTU0NjkwMDQ1OCwiZXhwIjoxNTQ2OTg2ODU4fQ.6hKwLfDxyvhSB__e1gshFwiwyuE3cBUqOHUA6V5fGqo",
}

```

<aside class="notice">
Refresh token only needs a refresh_token and not an API token.
</aside>


### HTTP Request

`POST /v1/token/refresh`


### BODY PARAMETERS

Parameter | Description
--------- | -----------
refresh_token | The refresh token of the user

## Verify token

```json
{
  "status": 200,
  "success": true,
  "msg": "Token is valid."
}
```

This endpoint verifies if the token sent in the header is valid.

<aside class="warning">
Verify token obviously needs a token in its header
</aside>


### HTTP Request

`GET /v1/token/verify`

## Generate a code to reset a password

```json
{
  "status": 200,
  "success": true,
  "msg": "Reset code successfully sent to email."
}
```

This endpoint generates a code to reset the password of the user with the email specified in the body. It then sends this code to this mail.

### BODY PARAMETERS

Parameter | Description
--------- | -----------
email | The user's email

### HTTP Request

`PATCH /v1/password/reset/generate/code`

## Check a code that reset a password

```json
{
  "status": 200,
  "success": true,
  "msg": "This code is valid."
}
```

This endpoint checks the code that was previously generated by the endpoint /v1/password/reset/generate/code

### HTTP Request

`GET /v1/password/reset/check/code/:code`

## Reset the password with a code

```json
{
  "status": 200,
  "sucecess": true,
  "msg": "Password updated.",
  "user": {
    "email": "Lel@test.apiSTPMARCHE",
    "last_login": "2019-01-08T01:07:46.000Z",
    "date_joined": "2018-12-03T21:37:10.000Z",
    "first_name": "testE",
    "last_name": "qsdfjkl",
    "password": "$2b$10$xH2gVJZH.OfhWWsSLfzKv.PU2lwfPYP4d1WbdwtBixKFbebkSIA96",
    "is_superuser": 1,
    "is_staff": 1,
    "is_active": 1,
    "id": 21,
    "refresh_token": "2qL9d4hY4qaggb9h",
    "profile_picture": "qQlkmjdf193jkhH8kn12n2N1HhhH",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IkxlbEB0ZXN0LmFwaVNUUE1BUkNIRSIsImlhdCI6MTU0NjkwOTY2NiwiZXhwIjoxNTQ2OTk2MDY2fQ.zA6HKl_prLP0xj-kPS1viCAlwhLSv2wIGPZ_KBfoLPU",
    "reset_password_code": "",
    "username": "TESTAPIeAPeeeIAPqsdfIkAPzI"
  }
}
```

This endpoint updates the password if the code sent is a valid code. It then sends a mail to the user.

### BODY PARAMETERS

Parameter | Description
--------- | -----------
code | The code to reset the password
password | The new password of the user


### HTTP Request

`POST /v1/password/reset`

## Check your password

```json
{
  "status": 200,
  "success": true,
  "msg": "The password is matching"
}
```

This endpoint checks if the password sent is matching the password of the user doing the call.

### BODY PARAMETERS

Parameter | Description
--------- | -----------
password | The password you want to check


### HTTP Request

`POST /v1/password/check`